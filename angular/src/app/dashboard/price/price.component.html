<div class="container my-4">
  <h2 class="mb-4 text-primary">
    <i class="bi bi-graph-up"></i> Pepper Price Prediction
  </h2>

  <!-- Prediction Form -->
  <form [formGroup]="predictionForm" (ngSubmit)="onSubmit()" class="mb-4">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">From Date</label>
        <input type="date" class="form-control" formControlName="dateFrom" />
      </div>

      <div class="col-md-4">
        <label class="form-label">To Date</label>
        <input type="date" class="form-control" formControlName="dateTo" />
      </div>

      <div class="col-md-4">
        <label class="form-label">Forecast Horizon (days)</label>
        <input type="number" class="form-control" formControlName="horizon" />
      </div>

      <div class="col-md-4">
        <label class="form-label">Lookback Window (seq)</label>
        <input type="number" class="form-control" formControlName="seqLen" />
      </div>

      <div class="col-md-4">
        <label class="form-label">Market Filter</label>
        <input
          type="text"
          class="form-control"
          formControlName="marketFilter"
          placeholder="e.g. Kochi"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label">Epochs</label>
        <input type="number" class="form-control" formControlName="epochs" />
      </div>

      <div class="col-md-4">
        <label class="form-label">Batch Size</label>
        <input type="number" class="form-control" formControlName="batchSize" />
      </div>

      <div class="col-md-4">
        <label class="form-label">Test Split (0–1)</label>
        <input
          type="number"
          class="form-control"
          formControlName="testSplit"
          step="0.05"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label">Minimum Days</label>
        <input type="number" class="form-control" formControlName="minDays" />
      </div>
    </div>

    <div class="mt-4 d-flex align-items-center">
      <button
        class="btn btn-primary"
        type="submit"
        [disabled]="loading || predictionForm.invalid"
      >
        <i class="bi bi-cpu me-2"></i>
        {{ loading ? 'Predicting...' : 'Run Forecast' }}
      </button>

      <div *ngIf="loading" class="ms-3 text-muted d-flex align-items-center">
        <div
          class="spinner-border spinner-border-sm text-primary me-2"
          role="status"
        ></div>
        Training model, please wait...
      </div>
    </div>
  </form>

  <hr />

  <!-- Results -->
  <div *ngIf="result && !loading" class="mt-4">
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <i class="bi bi-clipboard-data"></i> Recommendation Summary
      </div>
      <div class="card-body">
        <table class="table table-bordered table-sm">
          <tbody>
            <tr>
              <th>Last Price</th>
              <td>{{ result.summary.last_price | number:'1.2-2' }}</td>
            </tr>
            <tr>
              <th>Average Future</th>
              <td>{{ result.summary.avg_future | number:'1.2-2' }}</td>
            </tr>
            <tr>
              <th>% Change</th>
              <td
                [ngClass]="{
                  'text-success': result.summary.pct_change > 0,
                  'text-danger': result.summary.pct_change < 0
                }"
              >
                {{ result.summary.pct_change | number:'1.2-2' }}%
              </td>
            </tr>
            <tr>
              <th>Confidence</th>
              <td>{{ result.summary.confidence | percent:'1.0-0' }}</td>
            </tr>
            <tr>
              <th>RMSE</th>
              <td>{{ result.summary.rmse | number:'1.2-2' }}</td>
            </tr>
            <tr>
              <th>Recommendation</th>
              <td>
                <span
                  class="badge"
                  [ngClass]="{
                    'bg-success': result.summary.recommendation.includes('BUY'),
                    'bg-danger': result.summary.recommendation.includes('SELL'),
                    'bg-warning text-dark': result.summary.recommendation.includes('HOLD')
                  }"
                >
                  {{ result.summary.recommendation }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <div class="card">
          <div class="card-header bg-light">
            <i class="bi bi-bar-chart"></i> Model Metrics
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <strong>MAE:</strong> {{ result.metrics.MAE | number:'1.2-2' }}
            </li>
            <li class="list-group-item">
              <strong>RMSE:</strong> {{ result.metrics.RMSE | number:'1.2-2' }}
            </li>
          </ul>
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <div class="card">
          <div class="card-header bg-light">
            <i class="bi bi-calendar-week"></i> Forecast (Next
            {{ result.predictions.length }} Days)
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-sm mb-0">
              <thead class="table-light">
                <tr>
                  <th>Date</th>
                  <th>Predicted Price (₹)</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let p of result.predictions">
                  <td>{{ p.Date | date: 'mediumDate' }}</td>
                  <td>{{ p.PredictedPrice | number:'1.2-2' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
